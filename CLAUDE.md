# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Foundry-based Solidity project for ENS referrals smart contracts. The project implements renewal contracts that track referral information for .eth domain renewals, supporting both wrapped and unwrapped ENS names.

## Core Architecture

The project consists of two main renewal contracts:

### UniversalRegistrarRenewalWithOriginalReferrerEvent
- **Purpose**: Universal renewal contract that works with both wrapped and unwrapped .eth names
- **Strategy**: Renews through unwrapped ETHRegistrarController (for referral tracking) then synchronizes with WrappedEthRegistrarController
- **Key Dependencies**: `IETHRegistrarController`, `IWrappedEthRegistrarController`

### UniversalRegistrarRenewalWithAdditionalReferrerEvent
- **Purpose**: Dedicated renewal contract for wrapped .eth names with referral tracking
- **Strategy**: Calculates price, renews through WrappedEthRegistrarController, emits referral events
- **Key Dependencies**: `IWrappedEthRegistrarController`, `INameWrapper`

Both contracts implement `IRegistrarRenewalWithReferral` interface and are Ownable for future contract naming compatibility.

## Core Commands

### Building and Testing
```bash
# Build all contracts
forge build

# Run all tests
forge test

# Run tests with gas reporting
forge test --gas-report

# Format Solidity code
forge fmt

# Generate gas snapshots
forge snapshot
```

### Development Tools
```bash
# Start local blockchain node
anvil

# Start local node with mainnet fork (requires MAINNET_RPC_URL in .env)
anvil --fork-url $MAINNET_RPC_URL

# Run tests with mainnet fork
forge test --fork-url $MAINNET_RPC_URL

# Run tests using named RPC endpoint from foundry.toml
forge test --rpc-url mainnet

# Interactive Solidity REPL
chisel

# Get help for any command
forge --help
cast --help
anvil --help
```

## Dependencies

The project uses git submodules for dependency management with these key libraries:
- **OpenZeppelin Contracts v5.0.2**: Access control (Ownable)
- **ENS Contracts v1.6.0**: Core ENS interfaces and contracts
- **Forge-std v1.10.0**: Testing framework

Import mappings are defined in `remappings.txt`:
- `@openzeppelin/contracts/` → `lib/openzeppelin-contracts/contracts/`
- `ens-contracts/` → `lib/ens-contracts/contracts/`
- `forge-std/` → `lib/forge-std/src/`

## Project Structure

- `src/` - Smart contracts (renewal implementations and interfaces)
- `test/` - Test files (currently empty)
- `script/` - Deployment scripts (currently empty)
- `lib/` - External dependencies via git submodules
- `out/` - Build artifacts (generated by forge)
- `foundry.toml` - Foundry configuration
